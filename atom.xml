<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Verbose Tomato</title>
  
  
  <link href="https://www.allen0125.com/atom.xml" rel="self"/>
  
  <link href="https://www.allen0125.com/"/>
  <updated>2022-08-09T16:00:31.674Z</updated>
  <id>https://www.allen0125.com/</id>
  
  <author>
    <name>Allen Wang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GPU 密集服务的压测目标是什么</title>
    <link href="https://www.allen0125.com/2022/08/09/gpu-services-stress-testing/"/>
    <id>https://www.allen0125.com/2022/08/09/gpu-services-stress-testing/</id>
    <published>2022-08-09T15:56:16.000Z</published>
    <updated>2022-08-09T16:00:31.674Z</updated>
    
    <content type="html"><![CDATA[<p>TL;DR:</p><p>GPU 密集型服务的压测目标是：检验服务的每分钟计算任务数量是否逼近 <code>一分钟内计算次数 * batch_size * GPU 数量</code>，且服务能长时间保持稳定。</p><h2 id="颟顸的准备压测方案"><a href="#颟顸的准备压测方案" class="headerlink" title="颟顸的准备压测方案"></a>颟顸的准备压测方案</h2><p>上周四开始准备新接口的压测方案，这周二需要出压测结果。说实话，WebSocket、JMeter 以及「压测」对我来说都是新鲜东西，虽然这事儿没什么写代码的压力，但是把一个新鲜的事情做到让同事或者 Leader 认为达到 60 分的水平，对我来说还是挺有压力的（这里有一个观点是很多时候你认为做到 95% 以上时你的 Leader 可能只觉得你做的刚及格甚至离及格还差一点，我认同这个观点，并且不认为这个是 PUA，关于这个话题之后再开一篇 Blog 来聊吧）。然后我就带着一点点压力颟颟顸顸的开始准备压测方案了。</p><h3 id="先列一下我得到的需求："><a href="#先列一下我得到的需求：" class="headerlink" title="先列一下我得到的需求："></a>先列一下我得到的需求：</h3><ul><li>我们的目标是第一阶段支持 xx QPS, 第二阶段支持 xxx QPS</li><li>我们该如何保障？压测方案是什么？</li></ul><h3 id="我是怎么准备的："><a href="#我是怎么准备的：" class="headerlink" title="我是怎么准备的："></a>我是怎么准备的：</h3><p><em>Naive 预警</em></p><ul><li>第一阶段：<ul><li>xx QPS 那就需要模拟 xx 个用户来并发。</li></ul></li><li>第二阶段：<ul><li>在 liluo 的提醒下要清楚 xx 个用户并发和 QPS 之间的关系（他们并不是一个概念），思考之后我认为我们现在需要测试的是服务的 QPM，因为我们单次请求时长的单位为秒。</li></ul></li><li>第三个阶段：<ul><li>突然想到了算法同事做过单张 RTX 3080 Ti 的压力测试，当时个结果为 x QPS，测试目标又改为并发 <code>x QPS * GPU 数量</code> 个请求检验服务是否可以稳定响应，压力提高（并发增加）时候是否可以稳定响应。</li></ul></li></ul><p>我是按照第三个阶段的想法进行压测准备的。</p><h3 id="以上准备过程中的缺失："><a href="#以上准备过程中的缺失：" class="headerlink" title="以上准备过程中的缺失："></a>以上准备过程中的缺失：</h3><ol><li>混淆概念，QPS 这个概念不该用到这里，<em>QPS</em>：Queries Per Second意思是“每秒查询率”，QPM 亦是。</li><li>没有搞清楚压测目标就想压测方案，正确的压测目标应该是 Blog 开头提到的目标，然而这个目标我现在才想清楚。</li><li>是通过读以上内容看不出来的，我是在学习 JMeter 如何使用的过程中，边学边准备压测方案的，现在想一下这个也是让我没有系统性的思考、准备压测方案的重要原因，人的脑子只能不受干扰的认真做一件事情。</li><li>和 Leader 沟通不够及时、充分，自己认为有疑惑应该提出来一起讨论，颟顸的决定势必要埋下隐患。</li></ol><h2 id="正确的压测方案应该是？"><a href="#正确的压测方案应该是？" class="headerlink" title="正确的压测方案应该是？"></a>正确的压测方案应该是？</h2><ol><li>屏蔽 GPU 相关的服务，仅仅检测 WebSocket、DB、Redis 是否满足目标并发？</li><li>明确 WebSocket、DB、Redis 满足目标并发的最小资源占用是多少？</li><li>测试单个 <code>batch</code> 计算时长；即可评估 1min 内可计算 batch 数量。</li><li>准备 <code>batch_size * GPU</code>  数量个并发请求，请求数量为 <code>压测时长 * 1min 内可计算 batch 数量</code>，作为基本压测方案，要检验服务能不能平稳的抗住这个压力。</li><li>基于基本压测方案再准备若干个小的并发请求和大的并发请求（负载低，和负载高的情况）</li><li>开始压测，JMeter 能生成详细的报告。</li></ol><p>确定了 <code>batch_size</code> 其实就是确定了能够「榨干」GPU 计算资源的数据量是多少，所以压测时候不需要再评估要模拟的并发数量是多少，这个数量是确定的，只存在达不到这个并发数量，不可能测出超过这个并发数量的结果。</p><p>原本还想分析一下今天压测结果与目标结果之间的差距可能是受哪些因素影响，写到一半发现我想得都仅仅是我推测，还是实验之后再写出来吧。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;TL;DR:&lt;/p&gt;
&lt;p&gt;GPU 密集型服务的压测目标是：检验服务的每分钟计算任务数量是否逼近 &lt;code&gt;一分钟内计算次数 * batch_size * GPU 数量&lt;/code&gt;，且服务能长时间保持稳定。&lt;/p&gt;
&lt;h2 id=&quot;颟顸的准备压测方案&quot;&gt;&lt;a href=</summary>
      
    
    
    
    
    <category term="GPU,压力测试,JMeter" scheme="https://www.allen0125.com/tags/GPU-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-JMeter/"/>
    
  </entry>
  
  <entry>
    <title>驾照增驾D摩托车驾驶资格过程回顾</title>
    <link href="https://www.allen0125.com/2020/12/06/%E9%A9%BE%E7%85%A7%E5%A2%9E%E9%A9%BED%E6%91%A9%E6%89%98%E8%BD%A6%E9%A9%BE%E9%A9%B6%E8%B5%84%E6%A0%BC%E8%BF%87%E7%A8%8B%E5%9B%9E%E9%A1%BE/"/>
    <id>https://www.allen0125.com/2020/12/06/%E9%A9%BE%E7%85%A7%E5%A2%9E%E9%A9%BED%E6%91%A9%E6%89%98%E8%BD%A6%E9%A9%BE%E9%A9%B6%E8%B5%84%E6%A0%BC%E8%BF%87%E7%A8%8B%E5%9B%9E%E9%A1%BE/</id>
    <published>2020-12-06T15:54:45.000Z</published>
    <updated>2022-08-09T16:00:31.674Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/IMG_0530.JPG" alt="Licence Got"></p><h3 id="为什么想要增驾D？"><a href="#为什么想要增驾D？" class="headerlink" title="为什么想要增驾D？"></a>为什么想要增驾D？</h3><ul><li>小时候坐过我爸摩托的油箱上面，我爸给我买过小朋友的头盔，从小就喜欢。</li><li>现在有自行车，骑长途最多就骑过30公里，菜腿已经很累了。</li><li>周末骑摩托去郊区吹风，想想就很棒。</li><li>在北京没有汽车&#x2F;新能源指标，京B的摩托相对容易Get，京A的摩托车指标也可以合法交易。</li><li>操纵机械的快感。</li><li>衣食住行里的行能得到一部分的解决。</li><li>其实还有很多~</li></ul><h3 id="为什么选择D？"><a href="#为什么选择D？" class="headerlink" title="为什么选择D？"></a>为什么选择D？</h3><p>​因为我想骑跨子，在没考得驾照之前我想我之后会偶尔骑跨子接送我闺女（为什么不是儿子？我想要闺女啊）上幼儿园，她一定是全幼儿园最酷的仔。</p><p>​关于这个想法，我在满分通过科目四等着拿驾照的时候还和其它学院坐在一起吹牛皮，讨论为什么选D不选E<br>的时候我就说了我这个想法，然后之前我还吹了自己科目四满分通过的牛皮。然后大家就问我科目四没背<br>摩托车不能带12岁一下儿童的题吗？当时我就尴尬了（</p><p>​以上是学D的一部分原因，更多的原因其实是觉得D范围大，做事情的资格这种事情当然是范围越大越好吧？</p><h3 id="在北京怎么选择的驾校？"><a href="#在北京怎么选择的驾校？" class="headerlink" title="在北京怎么选择的驾校？"></a>在北京怎么选择的驾校？</h3><p>​我的C1是在龙泉驾校学的，C1学习的过程很顺利，教练的应试教育教的很好，我也没有补考过，约车通过<br>报名的教练约也没多操心过，然后和薰姐（推特上的一个大佬）聊天的过程中得知他（咦，不对劲）也是<br>在龙泉驾校学的，然后我就直接选择了龙泉驾校了。</p><h3 id="学习的过程大概是怎样的？"><a href="#学习的过程大概是怎样的？" class="headerlink" title="学习的过程大概是怎样的？"></a>学习的过程大概是怎样的？</h3><p>​摩托车增驾也有四个科目，并且我考科目二、三还遇到了新换的电子监考，更难了一些。</p><h4 id="科目一、科目四背题-考试"><a href="#科目一、科目四背题-考试" class="headerlink" title="科目一、科目四背题-考试"></a>科目一、科目四背题-考试</h4><p>​和C1类似，只不过是50道题了，更加Easy，这个就不多说了。</p><h4 id="科目二、科目三练习"><a href="#科目二、科目三练习" class="headerlink" title="科目二、科目三练习"></a>科目二、科目三练习</h4><p>​第一天去科目二的时候，练习和考试车都是嘉陵的跨子，教练教了如何启动，离合、油门、前轮刹车、后轮刹车、加减档、如何换档等操作<br>​然后开始练习启动、挂挡、起步、绕圈；大概练习了2个小时后，到了科目二考试练习场地，又换了个教练，<br>教了坡道停车、坡道起步、单边桥、绕桩；其中我觉得最难的就是绕桩了，跨子绕桩本身车身就很宽，然后桩<br>之间的距离还很窄。</p><p>​科目三就是按照流程走一遍，流程如下图所示，不要做错、熄火、长时间半离合就没什么问题。</p><p><img src="/images/IMG_0523.png" alt="Licence Got"></p><p>​龙泉驾校约考还比较麻烦，我约了很久，我是剩下两次练车的时候约的考试，我考试约在了周一，约到考试之后<br>​我在周六周日练了两天，然后周一考试还是很紧张，不过好再过了。</p><p>​科目二、科目三都是一把就通过了，通过了之后就回到了驾校开始背科目四的题，下午1点半左右的时候花了<br>10几分钟满分通过了科目四。然后四点就拿到了新的驾照。</p><h3 id="旧驾照怎么换的新驾照"><a href="#旧驾照怎么换的新驾照" class="headerlink" title="旧驾照怎么换的新驾照"></a>旧驾照怎么换的新驾照</h3><p>​驾校在考科目四之前收了两张一寸白底免冠带镜框的照片旧驾照以及驾照副页，带镜框是因为我近视，必须要有个体现；<br>​之前驾照的夹子留在了自己手里，然后在考完科目四之后给发了新的驾照、副页，并且还有新的驾照夹。<br>驾照上的准驾车型更新到了C1D，扣分周期不变，副页备注了增驾D的实习周期。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/IMG_0530.JPG&quot; alt=&quot;Licence Got&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;为什么想要增驾D？&quot;&gt;&lt;a href=&quot;#为什么想要增驾D？&quot; class=&quot;headerlink&quot; title=&quot;为什么想要增驾D？&quot;&gt;&lt;/a&gt;为</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>记录一次VPS被黑后长记心的过程</title>
    <link href="https://www.allen0125.com/2020/03/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1VPS%E8%A2%AB%E9%BB%91%E5%90%8E%E9%95%BF%E8%AE%B0%E5%BF%83%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
    <id>https://www.allen0125.com/2020/03/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1VPS%E8%A2%AB%E9%BB%91%E5%90%8E%E9%95%BF%E8%AE%B0%E5%BF%83%E7%9A%84%E8%BF%87%E7%A8%8B/</id>
    <published>2020-03-16T15:45:55.000Z</published>
    <updated>2022-08-09T16:00:31.674Z</updated>
    
    <content type="html"><![CDATA[<p>昨天去看了下我在海星云上不怎么用的那台 VPS，然后发现了流量超出被暂停了，<br>被暂停了是看不到每天流量进出口监控，所以我发了工单问了下是什么情况，<br>大概就是 3 月 3 号的时候突然的 VPS 出口流量很多，<br>估计是被用来做肉鸡然后去 <a href="https://www.cloudflare.com/zh-cn/learning/ddos/what-is-a-ddos-attack/">DDoS</a> 别人了吧。</p><p>​客服在看了流量是别黑没的之后好心的给我加了 400G，然后要求我在一个小时内解决掉被挂上的马。</p><p>​对于我这种运维小白来说，根本没有解决这种问题的经验，现在回头想下应该留一个快照之后研究用。<br>没有了实战环境那就学着从多个方面来提升 VPS 的安全程度就好了。<br>通过阅读资料我了解到了以下这些保证服务器安全的方法：</p><ol><li>SSH 相关安全；</li><li>防火墙相关安全；</li><li>rootkit 相关安全。</li></ol><p>在重新安装系统之后，我把本地的 SSH-Key 也替换了一遍，之前是 RSA 的 SSH Key，<br>现在换成了 ED25519 公、私钥更短，但是更加安全，是 RSA 安全性的10倍，<br>更换了本地 SSH Key 之后我开始设置 VPS 上的 SSH 配置，SSH 配置修改了以下几部分。</p><ol><li>替换默认 22 端口，改为其它端口；</li><li>创建新用户，加入 sudo 用户组，用户密码用 1Password 生成保证唯一；</li><li>ssh-copy-id 给新建的用户添加上 SSH 公钥；</li><li>禁止 root 用户登录；</li><li>3 次密码失败等待，10 次密码失败使用 fail2ban ban IP。</li></ol><p>​完成 SSH 相关安全配置之后就开始配置防火墙<br>iptables 的配置对我来说还挺繁琐的，所以我就用 ufw 来进行防火墙的配置了，<br>ufw 配置起来和各种云服务的防火墙配置感觉类似，allow 端口或者 deny 端口就好了。<br>配置防火墙需要注意的是一定要先把 SSH 的端口打开，不然忘记这个可真的就要翻车了。<br>然后就是需要哪些端口再打开哪些端口，其他的一律禁止就好了。<br>我现在就只打开了 SSH 的端口和 80 端口，毕竟是新装的系统，装了个 nginx 测试下防火墙的效果，<br>并且 nginx 之后还是会用到的。</p><p>​rootkit 是我刚从鸟哥的网站上了解到的内容，鸟哥网站上关于 rootkit 相关的内容其实有些旧了，<br>看下了解下什么是 rootkit，如何来应对就好，实际遇到问题的时候还是多参考官方手册就能解决掉绝大多数的问题。</p><p>检查VPS当中是否有 rootkit 主要用 RootKit Hunter 这个软件，这个软件在使用之前一定要运行<br><code>rkhunter —propupd</code> 命令来更新软件 md5 等数据库信息，保证数据库信息最新，避免一些不必要的 Warning。</p><p>​完成 SSH、防火墙、rootkit 相关安全配置之后其实服务器的安全程度就不错了，之后再注意及时打暴露的服务的补丁应该就可以了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;昨天去看了下我在海星云上不怎么用的那台 VPS，然后发现了流量超出被暂停了，&lt;br&gt;被暂停了是看不到每天流量进出口监控，所以我发了工单问了下是什么情况，&lt;br&gt;大概就是 3 月 3 号的时候突然的 VPS 出口流量很多，&lt;br&gt;估计是被用来做肉鸡然后去 &lt;a href=&quot;h</summary>
      
    
    
    
    
  </entry>
  
</feed>
